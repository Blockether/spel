<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test Reports Â· spel</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ­</text></svg>">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #f8f9fb; --bg-card: #fff; --bg-card-hover: #f6f7f9;
      --border: #e2e5ea; --border-hover: #cdd1d8;
      --text: #1a1d23; --text-sec: #5a6070; --text-muted: #8b92a0;
      --green: #2EAD33; --green-bg: rgba(46,173,51,0.06); --green-border: rgba(46,173,51,0.2);
      --green-text: #1d7a22; --red: #d94040; --red-bg: rgba(217,64,64,0.05); --red-border: rgba(217,64,64,0.2);
      --red-text: #b33030; --code-bg: #eef0f4; --code-text: #5a6070;
      --shadow: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.03);
      --shadow-h: 0 4px 12px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.04);
    }
    html.dark {
      --bg: #0f1219; --bg-card: #1a2030; --bg-card-hover: #1f2738;
      --border: #2a3142; --border-hover: #3a4358;
      --text: #e8eaf0; --text-sec: #9ba3b5; --text-muted: #5f6880;
      --green-bg: rgba(46,173,51,0.08); --green-border: rgba(46,173,51,0.25);
      --green-text: #4cd952; --red-bg: rgba(217,64,64,0.08); --red-border: rgba(217,64,64,0.25);
      --red-text: #f06060; --code-bg: #252d3d; --code-text: #9ba3b5;
      --shadow: 0 1px 3px rgba(0,0,0,0.2); --shadow-h: 0 4px 16px rgba(0,0,0,0.3);
    }
    body { font-family: system-ui, -apple-system, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; -webkit-font-smoothing: antialiased; }
    @keyframes fade-in { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    .header { padding: 1.5rem 1rem 1rem; text-align: center; }
    .logo { width: 64px; height: 64px; margin: 0 auto; opacity: 0.9; }
    .logo svg { width: 100%; height: 100%; }
    .title { font-family: 'Iowan Old Style', 'Palatino Linotype', Palatino, Georgia, serif; font-size: 1.75rem; font-weight: 700; letter-spacing: 0.05em; margin-bottom: 0.2rem; }
    .subtitle { font-size: 0.7rem; color: var(--text-muted); letter-spacing: 0.15em; text-transform: uppercase; }

    .main { max-width: 52rem; margin: 0 auto; padding: 0.5rem 1.5rem 3rem; }
    .builds { display: flex; flex-direction: column; gap: 0.5rem; }

    .date-group { font-size: 0.7rem; font-weight: 600; color: var(--text-muted); letter-spacing: 0.06em; text-transform: uppercase; padding: 0.75rem 0.25rem 0.35rem; border-bottom: 1px solid var(--border); margin-top: 0.5rem; }
    .date-group:first-child { margin-top: 0; }

    .card { display: flex; align-items: center; gap: 1rem; padding: 0.875rem 1.25rem; border-radius: 0.75rem; border: 1px solid var(--border); background: var(--bg-card); box-shadow: var(--shadow); text-decoration: none; color: inherit; transition: all 0.2s ease; animation: fade-in 0.4s ease-out both; cursor: pointer; }
    .card:hover { border-color: var(--border-hover); background: var(--bg-card-hover); box-shadow: var(--shadow-h); transform: translateY(-1px); }
    .card.latest { border-color: var(--green-border); background: var(--green-bg); }
    .card.latest:hover { border-color: var(--green); }
    .card.failed { border-color: var(--red-border); background: var(--red-bg); }
    .card.failed:hover { border-color: var(--red); }

    .run { flex-shrink: 0; width: 3.5rem; text-align: center; }
    .run-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); }
    .latest .run-label { color: var(--green-text); }
    .run-num { font-size: 1.4rem; font-weight: 700; font-variant-numeric: tabular-nums; color: var(--text); }
    a.run-link { text-decoration: none; color: var(--text); transition: color 0.2s; }
    a.run-link:hover { color: var(--green); }
    .status-dot { flex-shrink: 0; width: 1.25rem; font-size: 0.75rem; text-align: center; font-weight: 700; line-height: 1; }
    .status-pass { color: var(--green); }
    .status-fail { color: var(--red); }
    .divider { width: 1px; height: 2.5rem; background: var(--border); flex-shrink: 0; }
    .latest .divider { background: var(--green-border); }
    .failed .divider { background: var(--red-border); }

    .info { flex: 1; min-width: 0; }
    .info-top { display: flex; align-items: center; gap: 0.4rem; margin-bottom: 0.25rem; }
    .sha { display: inline-block; padding: 0.15rem 0.4rem; border-radius: 0.25rem; font-size: 0.7rem; font-family: 'SF Mono', 'Fira Code', Consolas, monospace; background: var(--code-bg); color: var(--code-text); }
    .sha-link { text-decoration: none; transition: background 0.2s, color 0.2s; }
    .sha-link:hover { background: var(--border-hover); color: var(--text); }
    .latest .sha { background: var(--green-bg); color: var(--green-text); }
    .latest .sha-link:hover { background: var(--green-border); color: var(--green-text); }
    .failed .sha { background: var(--red-bg); color: var(--red-text); }
    .failed .sha-link:hover { background: var(--red-border); color: var(--red-text); }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.6rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; background: var(--green-bg); color: var(--green-text); border: 1px solid var(--green-border); margin-left: 8px; }
    .msg { font-size: 0.82rem; color: var(--text-sec); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .latest .msg { color: var(--text); }
    .author { margin: 0.1rem 0 0; font-size: 0.72rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .meta { flex-shrink: 0; text-align: right; }
    .meta-date { font-size: 0.7rem; color: var(--text-muted); font-variant-numeric: tabular-nums; }
    .meta-rel { font-size: 0.6rem; color: var(--text-muted); opacity: 0.7; font-variant-numeric: tabular-nums; }
    .arrow { width: 1rem; height: 1rem; flex-shrink: 0; color: var(--text-muted); transition: all 0.2s; }
    .card:hover .arrow { color: var(--text-sec); transform: translateX(2px); }

    .empty { display: none; text-align: center; color: var(--text-muted); margin-top: 4rem; font-size: 1rem; }
    .empty.show { display: block; }

    .footer { text-align: center; padding-bottom: 2rem; font-size: 0.7rem; color: var(--text-muted); }
    .footer a { color: var(--text-sec); text-decoration: none; transition: color 0.2s; }
    .footer a:hover { color: var(--green); }

    .theme-toggle { position: fixed; top: 1rem; right: 1rem; width: 2rem; height: 2rem; border-radius: 50%; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-sec); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; z-index: 50; box-shadow: var(--shadow); }
    .theme-toggle:hover { border-color: var(--border-hover); background: var(--bg-card-hover); }
    .theme-toggle svg { width: 1rem; height: 1rem; }
    .theme-toggle .icon-moon { display: none; }
    html.dark .theme-toggle .icon-sun { display: none; }
    html.dark .theme-toggle .icon-moon { display: block; }

    .pill { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.6rem; font-weight: 600; margin-left: 8px; letter-spacing: 0.03em; border: 1px solid; vertical-align: middle; }
    .pill-green { background: var(--green-bg); color: var(--green-text); border-color: var(--green-border); }
    .pill-yellow { background: rgba(255,193,7,0.10); color: #8a6d00; border-color: rgba(255,193,7,0.4); }
    .pill-blue { background: rgba(0,126,198,0.08); color: #006bb3; border-color: rgba(0,126,198,0.3); }
    .pill-red { background: var(--red-bg); color: var(--red-text); border-color: var(--red-border); }
    html.dark .pill-yellow { background: rgba(255,193,7,0.12); color: #ffd54f; border-color: rgba(255,193,7,0.35); }
    html.dark .pill-blue { background: rgba(0,126,198,0.12); color: #64b5f6; border-color: rgba(0,126,198,0.35); }

    @media (max-width: 640px) { .meta { display: none; } .card { padding: 0.75rem 1rem; gap: 0.75rem; } .info-top { flex-wrap: wrap; } }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
    <svg class="icon-sun" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
    <svg class="icon-moon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
  </button>

  <header class="header">
    <div class="logo"><!--LOGO_PLACEHOLDER--></div>
    <h1 class="title"><!--TITLE_PLACEHOLDER-->spel<!--/TITLE_PLACEHOLDER--></h1>
    <p class="subtitle"><!--SUBTITLE_PLACEHOLDER-->Clojure Ã— Playwright Â· Test Reports<!--/SUBTITLE_PLACEHOLDER--></p>
  </header>

  <main class="main">
    <div id="builds" class="builds"></div>
    <p id="empty" class="empty">No reports yet. Push to main to generate one.</p>
  </main>

  <footer class="footer">
    Powered by <a href="https://github.com/Blockether/spel">spel</a>
    &middot; Reports by <a href="https://allurereport.org">Allure</a>
  </footer>

  <script>
    (function() {
      var saved = localStorage.getItem('spel-theme');
      if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches))
        document.documentElement.classList.add('dark');
    })();
    function toggleTheme() {
      var d = document.documentElement.classList.toggle('dark');
      localStorage.setItem('spel-theme', d ? 'dark' : 'light');
    }

    function relativeTime(ts) {
      var diff = Date.now() - ts, m = Math.floor(diff / 60000);
      if (m < 1) return 'just now';
      if (m < 60) return m + 'm ago';
      var h = Math.floor(m / 60);
      if (h < 24) return h + 'h ago';
      var d = Math.floor(h / 24);
      return d < 30 ? d + 'd ago' : null;
    }
    function formatDate(ts) {
      if (!ts) return '';
      var d = new Date(ts);
      return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
        + ' ' + d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
    }
    function truncate(s, n) {
      if (!s) return '';
      var f = s.split('\n')[0];
      return f.length > n ? f.slice(0, n) + '\u2026' : f;
    }

    function renderBuild(b, i, isLatest) {
      var sha = (b.sha || '').slice(0, 8);
      var fullSha = b.sha || '';
      var repoUrl = b.repo_url || '';
      var runUrl = b.run_url || '';
      var msg = truncate(b.message, 80);
      var author = b.author || '';
      var date = b.timestamp ? formatDate(b.timestamp) : '';
      var rel = b.timestamp ? relativeTime(b.timestamp) : '';
      var delay = Math.min(i, 9) * 0.05;
      var failed = b.passed === false;
      var cardClass = 'card' + (isLatest ? ' latest' : '') + (failed ? ' failed' : '');

      var shaHtml = '';
      if (sha) {
        if (repoUrl && fullSha) {
          shaHtml = '<a href="' + repoUrl + '/commit/' + fullSha + '" class="sha sha-link" target="_blank" rel="noopener" onclick="event.stopPropagation()">' + sha + '</a>';
        } else {
          shaHtml = '<code class="sha">' + sha + '</code>';
        }
      }

      var statusDot = '';
      if (failed) {
        statusDot = '<span class="status-dot status-fail" title="Failed">âœ—</span>';
      } else {
        statusDot = '<span class="status-dot status-pass" title="Passed">âœ“</span>';
      }

      var versionBadge = '';
      if (b.version) {
        var pillClass = b.badge === 'release' ? 'pill-green' : 'pill-yellow';
        versionBadge = '<span class="pill ' + pillClass + '">' + b.version + '</span>';
      }

      var testBadge = '';
      if (b.tests) {
        var tp = b.tests.passed || 0;
        var tf = (b.tests.failed || 0) + (b.tests.broken || 0);
        if (tp > 0 || tf > 0) {
          var testMsg = tf > 0 ? tp + ' passed, ' + tf + ' failed' : tp + ' passed';
          var testPill = tf > 0 ? 'pill-red' : 'pill-blue';
          testBadge = '<span class="pill ' + testPill + '">' + testMsg + '</span>';
        }
      }

      return '<div class="' + cardClass + '" style="animation-delay:' + delay + 's" onclick="window.location.href=\'' + b.run + '/\'" role="link" tabindex="0">'
        + '<div class="run"><div class="run-label">Run</div>'
        + (runUrl
          ? '<a href="' + runUrl + '" class="run-num run-link" target="_blank" rel="noopener" onclick="event.stopPropagation()" title="View CI pipeline">#' + b.run + '</a>'
          : '<div class="run-num">#' + b.run + '</div>')
        + '</div>'
        + statusDot
        + '<div class="divider"></div>'
        + '<div class="info"><div class="info-top">'
        + shaHtml
        + testBadge
        + versionBadge
        + (isLatest ? '<span class="badge">Latest</span>' : '')
        + '</div><p class="msg">' + (msg || 'No commit message') + '</p>'
        + (author ? '<p class="author">by ' + author + '</p>' : '')
        + '</div>'
        + '<div class="meta">'
        + (date ? '<div class="meta-date">' + date + '</div>' : '')
        + (rel ? '<div class="meta-rel">' + rel + '</div>' : '')
        + '</div>'
        + '<svg class="arrow" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>'
        + '</div>';
    }

    function dateLabel(ts) {
      var d = new Date(ts);
      var now = new Date();
      var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
      var target = new Date(d.getFullYear(), d.getMonth(), d.getDate());
      var diff = (today - target) / 86400000;
      if (diff < 1 && diff >= 0) return 'Today';
      if (diff >= 1 && diff < 2) return 'Yesterday';
      return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
    }

    fetch('builds.json')
      .then(function(r) { return r.json(); })
      .then(function(builds) {
        var el = document.getElementById('builds');
        if (!builds.length) { document.getElementById('empty').classList.add('show'); return; }
        var html = '';
        var lastGroup = '';
        builds.forEach(function(b, i) {
          if (b.timestamp) {
            var group = dateLabel(b.timestamp);
            if (group !== lastGroup) {
              html += '<div class="date-group">' + group + '</div>';
              lastGroup = group;
            }
          }
          html += renderBuild(b, i, i === 0);
        });
        el.innerHTML = html;
      })
      .catch(function() { document.getElementById('empty').classList.add('show'); });
  </script>
</body>
</html>
